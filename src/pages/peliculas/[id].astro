---
import Layout from "@layouts/Layout.astro";
import fs from 'fs/promises';
import path from 'path';

export async function getStaticPaths() {
  const dataPath = path.resolve(process.cwd(), 'public/data/peliculas.json');
  const peliculasJson = await fs.readFile(dataPath, 'utf-8');
  const peliculas = JSON.parse(peliculasJson);

  return peliculas.map(pelicula => ({
    params: { id: String(pelicula.id) }
  }));
}



const { id } = Astro.params;

// Aquí también debes leer el JSON (o puedes moverlo a una función común)
const dataPath = path.resolve(process.cwd(), 'public/data/peliculas.json');
const peliculasJson = await fs.readFile(dataPath, 'utf-8');
const peliculas = JSON.parse(peliculasJson);

const pelicula = peliculas.find(p => String(p.id) === id);
---
<Layout>
  <div class="page-container">
  {pelicula ? (
    <div class="detalle-pelicula">
      <img src={pelicula.imagen} alt={pelicula.titulo} class="imagen-detalle" />
      <div class="info-detalle">
        <h2>{pelicula.titulo}</h2>
        <p><strong>Sinopsis:</strong> {pelicula.descripcion}</p>
        <p><strong>Duración:</strong> {pelicula.duracion}</p>
        <p><strong>Categoría:</strong> {pelicula.categoria}</p>
        <p><strong>Estrellas:</strong> {"⭐️".repeat(pelicula.estrellas || 4)}</p>
        <a href="/peliculas" class="boton">← Volver</a>
      </div>
    </div>
  ) : (
    <p>Película no encontrada.</p>
  )}
  </div>

	<!-- script de sesion -->
  <script is:inline>
    const usuario = JSON.parse(localStorage.getItem("usuario"));

    if (!usuario) {
      Swal.fire({
        icon: "warning",
        title: "Sesión requerida",
        text: "Debes iniciar sesión para acceder a esta página",
        confirmButtonText: "Ir al inicio",
        confirmButtonColor: "#3085d6"
      }).then(() => {
        window.location.href = "/";
      });
    }

    document.getElementById("logout").addEventListener("click", () => {
      Swal.fire({
        icon: "question",
        title: "¿Cerrar sesión?",
        text: "Se cerrará tu sesión actual",
        showCancelButton: true,
        confirmButtonText: "Sí, salir",
        cancelButtonText: "Cancelar",
        confirmButtonColor: "#d33",
        cancelButtonColor: "#3085d6"
      }).then((result) => {
        if (result.isConfirmed) {
          localStorage.removeItem("usuario");
          Swal.fire({
            icon: "success",
            title: "Sesión cerrada",
            showConfirmButton: false,
            timer: 1500
          }).then(() => {
            window.location.href = "/";
          });
        }
      });
    });
	</script>
  <style>
    :root {
      --page-bg: linear-gradient(to bottom, #02216c, #005d9b);
      --heading-color: #ff4081;
      --text-color: white;
      --button-bg: #ff4081;
      --button-hover: #e91e63;
    }
  
    [data-theme="dark"] {
      --page-bg: linear-gradient(to bottom, #000428, #004e92);
      --heading-color: #ff80ab;
      --text-color: #f0f0f0;
      --button-bg: #ff4081;
      --button-hover: #c2185b;
    }
  
    .page-container {
      background: var(--page-bg); /* degradado oscuro violeta-azulado */
      min-height: 100vh; /* para que tome toda la altura visible */
      padding: 20px 0;
    }
  
    .detalle-pelicula {
      display: flex;
      justify-content: center;
      gap: 2.5rem; /* espacio relativo */
      padding: 2.5rem;
    }
  
    .imagen-detalle {
      width: 100%;
      max-width: 20rem; /* máximo ancho, unos 320px */
      border-radius: 0.625rem; /* 10px */
      box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.4); /* sombra relativa */
      flex-shrink: 0; /* no achicar demasiado */
    }
  
    .info-detalle {
      flex: 1 1 300px; /* que ocupe lo que queda, mínimo 300px */
      max-width: 40rem; /* máximo ancho */
    }
  
    .info-detalle h2 {
      font-size: 2rem; /* ya es relativo a la base del documento */
      margin-bottom: 1rem;
      color: var(--heading-color);
    }
  
    .info-detalle p {
      margin: 0.625rem 0; /* 10px */
      font-size: 1.1rem;
      line-height: 1.5;
      color: var(--text-color);
    }
  
    .boton {
      display: inline-block;
      margin-top: 1.25rem; /* 20px */
      padding: 0.625rem 1.25rem; /* 10px 20px */
      background-color: var(--button-bg);
      color: white;
      border-radius: 0.5rem; /* 8px */
      text-decoration: none;
      transition: background-color 0.3s ease;
    }
  
    .boton:hover {
      background-color: var(--button-hover);
    }
  
    @media (max-width: 600px) {
      .detalle-pelicula {
        display: flex;
        flex-direction: column;
        padding: 1rem;
        gap: 1.5rem;
      }
  
      .info-detalle {
        max-width: 100%;
      }
  
      .info-detalle h2 {
        font-size: 1.5rem;
      }
  
      .info-detalle p {
        font-size: 1rem;
      }
    }
  </style>
  
</Layout>
